#!/bin/bash

echo "üö® URGENTE: Execute o SQL no Supabase Dashboard"
echo ""
echo "‚ùå Erro encontrado: Colunas 'manager_id' n√£o existem na tabela 'videos'"
echo ""
echo "üîß SOLU√á√ÉO R√ÅPIDA:"
echo "1. Abra: https://supabase.com/dashboard"
echo "2. Entre no seu projeto"
echo "3. V√° em 'SQL Editor'"
echo "4. Copie e execute o SQL abaixo:"
echo ""
echo "================================================"
echo "-- SQL PARA EXECUTAR NO SUPABASE:"
echo ""
echo "-- Adicionar colunas necess√°rias"
echo "ALTER TABLE public.videos"
echo "ADD COLUMN IF NOT EXISTS created_by_type VARCHAR DEFAULT 'system',"
echo "ADD COLUMN IF NOT EXISTS created_by_id UUID,"
echo "ADD COLUMN IF NOT EXISTS manager_id UUID REFERENCES public.managers(id),"
echo "ADD COLUMN IF NOT EXISTS company_id UUID REFERENCES public.companies(id),"
echo "ADD COLUMN IF NOT EXISTS display_order INTEGER DEFAULT 0;"
echo ""
echo "-- Atualizar v√≠deos existentes"
echo "UPDATE public.videos"
echo "SET created_by_type = 'system',"
echo "    display_order = CASE"
echo "        WHEN title ILIKE '%introdu√ß√£o%' THEN 1"
echo "        WHEN title ILIKE '%b√°sico%' THEN 2"
echo "        WHEN title ILIKE '%avan√ßado%' THEN 10"
echo "        ELSE 5"
echo "    END"
echo "WHERE created_by_type IS NULL;"
echo ""
echo "-- Criar √≠ndices"
echo "CREATE INDEX IF NOT EXISTS idx_videos_created_by_type ON public.videos(created_by_type);"
echo "CREATE INDEX IF NOT EXISTS idx_videos_manager_id ON public.videos(manager_id);"
echo "CREATE INDEX IF NOT EXISTS idx_videos_company_id ON public.videos(company_id);"
echo "================================================"
echo ""
echo "‚úÖ Ap√≥s executar o SQL, teste novamente o upload de v√≠deos"
echo ""
echo "üß™ Para testar: Cole scripts/test-video-upload.js no Console do navegador"